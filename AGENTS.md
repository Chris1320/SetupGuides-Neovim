# AGENTS.md

Repository: **SetupGuides-Neovim**.

This repo is a distributable Neovim configuration (based on **LazyVim**) plus helper scripts (installer + file list generation) and CI linting.

## Quick start (most common commands)

- Regenerate the generated file list (required when `src/` changes):
  ```bash
  python3 ./scripts/generate_file_list.py
  ```
  (writes `files.txt`) (`scripts/generate_file_list.py:11-33`)

- Run the interactive installer (destructive; overwrites `~/.config/nvim`):
  ```bash
  ./install
  ```

## Repository layout

- `src/` — the Neovim config that gets installed to `~/.config/nvim/`
  - `src/init.lua` — entrypoint (`require("config.lazy")`) (`src/init.lua:1-2`)
  - `src/lua/config/` — core configuration modules
    - `lazy.lua` — bootstraps `lazy.nvim` and loads LazyVim + local plugins (`src/lua/config/lazy.lua:1-53`)
    - `options.lua` — vim options + some environment-specific behavior (WSL clipboard) (`src/lua/config/options.lua:1-40`)
    - `keymaps.lua` — custom mappings (uses `vim.keymap.set`) (`src/lua/config/keymaps.lua:11-38`)
    - `autocmds.lua`, `misc.lua` — additional config/utilities
  - `src/lua/plugins/` — Lazy plugin specs/overrides (Lua files returning tables)
  - `src/lazyvim.json` — LazyVim “extras” list used by LazyVim
- `install` — interactive installer script (supports local + remote install)
- `scripts/` — helper scripts
  - `generate_file_list.py` — regenerates `files.txt` from `src/`
  - `move.py` — toggles Neovim directories to/from `.bak` for testing
  - `reset.sh` — deletes all local Neovim dirs (destructive)
- `files.txt` — generated list of raw GitHub URLs for all files under `src/`
- `.git-hooks/pre-commit` — regenerates and stages `files.txt` on commit

## How distribution works (`files.txt` + installer)

- `files.txt` is generated by walking `src/` and emitting raw GitHub URLs (one per file) (`scripts/generate_file_list.py:23-31`).
- The installer has a “remote install” path that downloads `files.txt` from GitHub and then downloads each file into the user’s `~/.config/nvim` (`install:248+`).
- The pre-commit hook runs the generator and stages `files.txt`:
  - `python3 ./scripts/generate_file_list.py`
  - `git add ./files.txt`
  (`.git-hooks/pre-commit:1-7`)

## Neovim/Lua structure and conventions

### LazyVim + lazy.nvim bootstrap

- Entry is `src/init.lua` → `require("config.lazy")`.
- `src/lua/config/lazy.lua` bootstraps `lazy.nvim` into Neovim’s data directory and calls `require("lazy").setup({ spec = ... })`.
  - LazyVim is imported via `{ "LazyVim/LazyVim", import = "lazyvim.plugins" }`.
  - Local plugin specs are imported via `{ import = "plugins" }`.

### Plugin specs

- Files under `src/lua/plugins/` return plugin spec tables (lazy.nvim style).
- Example lints/formatters integration:
  - Formatting is configured via `conform.nvim` (`src/lua/plugins/conform.lua:1-100`).
  - Linting is configured via `nvim-lint` (`src/lua/plugins/nvim-lint.lua:1-44`).

### Formatting / lint pragmas in Lua

- Some Lua files use Selene directives like:
  - `-- selene: allow(unused_variable)`
  - `--# selene: allow(multiple_statements)`
  Examples: `src/lua/plugins/conform.lua:55`, `src/lua/config/keymaps.lua:1`.

## Tooling / CI

CI is defined in `.github/workflows/linter.yaml` and runs:

- **Selene** for Lua linting via `NTBBloodbath/selene-action@v1.0.0` (`.github/workflows/linter.yaml:19-24`).
- **super-linter** (slim) validating:
  - GitHub Actions YAML
  - Markdown
  - Python (pylint)
  - Shell formatting (shfmt)
  (`.github/workflows/linter.yaml:25-33`).

### Formatting and lint config files

Observed repo-level configs:

- `.editorconfig` — LF endings, 4-space indent; Markdown uses 2-space indent (`.editorconfig:1-11`).
- `stylua.toml` — `indent_width=4`, `column_width=120` (`stylua.toml:1-3`).
- `selene.toml` — uses `.selene.neovim` standard, allows `mixed_table` lint (`selene.toml:1-6`).
- `.markdownlint.yaml` — disables MD013 line length.
- `.neoconf.json` — config for `lua_ls` via neoconf.

## Local testing / workflows

### Install + iterate safely

If you need to test configuration changes locally, the repo includes scripts to avoid clobbering your existing Neovim setup:

- Temporarily move Neovim directories to backups:
  ```bash
  python3 ./scripts/move.py
  ```
- Restore originals:
  ```bash
  python3 ./scripts/move.py --return
  ```

These operate on:
- `~/.config/nvim`
- `~/.local/share/nvim`
- `~/.local/state/nvim`
- `~/.cache/nvim`
(`scripts/move.py:12-18`)

## Safety / gotchas

- `install` is destructive: it removes `~/.config/nvim` before copying `./src` (`install:226-234`).
- `scripts/reset.sh` is destructive: it deletes Neovim config, state, cache, and installed plugins (`scripts/reset.sh:1-6`).
- `scripts/move.py` can delete an existing destination directory if you confirm overwrite (or pass `--force`) (`scripts/move.py:58-72`).

## What to read first when changing behavior

- Startup/bootstrap: `src/init.lua`, `src/lua/config/lazy.lua`
- Defaults/customizations: `src/lua/config/options.lua`, `src/lua/config/keymaps.lua`, `src/lua/config/autocmds.lua`
- Plugin behavior: files under `src/lua/plugins/` (especially `conform.lua`, `nvim-lint.lua`, `lsp.lua`)
- Distribution/installer concerns: `install`, `scripts/generate_file_list.py`, `files.txt`
